<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="com.isix.easyGym.freeboard.dao.FreeDAO">  <!-- namespace는 mapper의 이름을 정의 -->
 
 	<resultMap type="freeDTO" id="fbResult"> <!-- typeAlias에 설정한 alias를 type으로 준다. -->
 		<result property="freeNo" column="freeNo"/>  <!--set와 같은역할 resultType으로 memberDTO 또는 resultMap을 사용하여 setting을 바로 한다.--> 
 		<result property="freeTitle" column="freeTitle"/>
 		<result property="freeContent" column="freeContent"/>
 		<result property="freeWriteDate" column="freeWriteDate"/>
 		<result property="freeHit" column="freeHit"/>
 		<result property="rating" column="rating"/>
 		<result property="memberNo" column="memberNo"/>
 	</resultMap>

	<resultMap type="freeImageDTO" id="imgResult">
		<result property="imageFileNo" column="imageFileNo"/>
		<result property="imageFileName" column="imageFileName"/>
		<result property="regdate" column="regdate"/>
		<result property="freeNo" column="freeNo"/>
	</resultMap>

	<select id="selectAll" resultMap="fbResult" parameterType="int">
	
		<![CDATA[
 			select * from freeboard_tbl order by freeNo desc limit #{count},10		
 		]]>
	</select>
	<select id="selectToFboard" resultType="int">
		<![CDATA[
 			select count(*) from freeboard_tbl
 		]]>
	</select>
	
	<select id="getNewFreeNo" resultType="int">
		<![CDATA[
 			select max(freeNo)+1 from freeboard_tbl 		
 		]]>
	</select>
	
	<insert id="insertNewFboard" parameterType="java.util.Map">
		insert into board_tbl values(#{articleNo},#{title},#{content},#{imageFileName},sysdate(),#{id})
	</insert>
	
	<select id="selectFboard" resultType="freeDTO" parameterType="int">
		<![CDATA[
 			select * from freeboard_tbl where freeNo = #{freeNo} 		
 		]]>
	</select>
	
	<select id="selectImageFileList" resultMap="imgResult" parameterType="int">
		<![CDATA[
 			select * from imagefile_tbl where freeNo = #{freeNo} 		
 		]]>
	</select>
	
	<!-- 오라클 , 여러개의 데이터베이스에서 한꺼번에 insert문 반복 수행
	<insert id="insertNewImages" parameterType="java.util.Map">
		<foreach collection="list" item="item" open="INSERT ALL" separator="" close="SELECT * FROM">
			INTO imagefile_tbl(imageFileName, regDate, articleNo) VALUES (#{item.ImageFileName},sysdate(), #{item.articleNo})
		</foreach> 
	</insert>
	-->
	<!-- articleNo의 item은 붙이지 않는다. fk이기 때문에?-->
	<insert id="insertNewImages" parameterType="java.util.Map">
		insert into imagefile_tbl values 
		<foreach collection="imageFileList" item="item" separator=",">
			(#{item.imageFileNo},#{item.imageFileName},sysdate(),#{freeNo})
		</foreach>
	</insert>
	
	<!-- 이미지 한개 글 수정 -->
	<!--<update id="updateArticle" parameterType="java.util.Map">
 			update board_tbl set title=#{title}, content=#{content}
 			<if test="imageFileName != '' and imageFileName != null"> 
 				, imageFileName=#{imageFileName}
 			</if>
 			where articleNo=#{articleNo}	
	</update> -->
	
	<!-- 이미지 여러개 글 수정 -->
	<update id="updateFboard" parameterType="java.util.Map">
 			update freeboard_tbl set title=#{title}, content=#{content} where freeNo=#{freeNo}	
	</update>
	
	<!-- 이미지 여러개 수정-->
	<update id="updateImage" parameterType="java.util.Map">
		<foreach collection="imageFileList" item="item" separator=";">
			
				update imagefile_tbl set imageFileName=#{item.imageFileName} where imageFileNo=#{item.imageFileNo} and #{item.imageFileName} != ''
           
         </foreach>
	</update>
	
	<delete id="deleteFboard" parameterType="int">
		<![CDATA[
			delete from freeboard_tbl where freeNo=#{freeNo}
		]]>
	</delete>
 
 </mapper>